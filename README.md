# gosync  
A sync tools by golang. Sync files from one node to one or more nodes.  

## 算法流程   
1. 在每个主机节点运行守护进程gosync;  
2. 在任意主机上打开客户端, 向需要向其他主机同步文件的主机发起同步任务;  
3. 源主机向所有目标主机发起连接, 即第一层连接;  
4. 源主机向所有目标主机发送本地同步文件列表和列表的md5;  
5. 目标主机收到文件列表和本地文件列表进行对比(对比的是md5);  
6. 目标主机对本地目录, 软连接, 需要删除的文件进行创建或删除操作;  
7. 目标主机把需要同步的文件列表返回给源主机;  
8. 源主机收到所有目标主机的请求列表, 进行比对归类;  
9. 源主机调用N个goroutine对每个类别并发执行同步任务;  
10. 在每个类别下, 建立起一个第二层连接, 二层连接是一个树状结构的连接树;  
11. 在每个类别下同步文件;  
12. 每个二层连接中的节点都会把接收到的数据在保存到本地的同时向下游节点转发;
13. 当二层连接的节点发现自己的同步任务已完成时, 会把结果发送到一层连接;  
14. 二层连接被断开;  
15. 一层连接将同步结果返回给源主机;  
16. 源主机将结果汇总返回给客户端;  
17. 一层网络被断开, 任务执行完成;  
18. 守护进程继续等待下次的同步任务;  

### 两层连接模型   

### 第一层连接   
源主机节点和所有的目标主机节点建立连接;  
![chart1](https://github.com/jacenr/gosync/blob/alg2/Screenshots/gosync_p1.png)  
### 第二层连接   
按类别建立起连接树;  
![chart1](https://github.com/jacenr/gosync/blob/alg2/Screenshots/gosync_p2.png)  
